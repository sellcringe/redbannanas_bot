from aiogram import Router, F
from aiogram.types import Message, CallbackQuery, ReplyKeyboardRemove
from aiogram.filters import Command

from src.db.database import sessionmaker
from src.filters.access_check import Guard
from src.keys.onboard_keys import cmd_start, method_work, work_form, story_complete_key, get_meet, \
    send_reglaments_about_services
from src.service.webhook_bitrix import get_ceo_by_username_in_bitrix

router = Router()


# Guard(session=sessionmaker),
@router.message(Command('start', prefix='!/') )
async def start(message: Message):
    await message.answer("""–ü—Ä–∏–≤–µ—Ç –∏ –¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ BANANAS TEAM! 

–Ø –±–∞–Ω–∞–Ω–æ–≤—ã–π –±–æ—Ç ‚Äì –±—É–¥—É —Ç–≤–æ–∏–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º –≤ –ø–µ—Ä–≤—ã–µ –¥–Ω–∏.
–ï—Å–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –±—É–¥–µ—Ç —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ ‚Äì –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ –õ–µ—Ä–∞ @to_see_sea, –º–æ–∂–µ—à—å –Ω–∞–ø–∏—Å–∞—Ç—å –µ–π –ø–æ –ª—é–±—ã–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–º –≤–æ–ø—Ä–æ—Å–∞–º. 

–î–∞–≤–∞–π –Ω–∞—á–Ω—ë–º –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –Ω–∞—à–µ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤—É ‚Äì –Ω–∞–∂–∏–º–∞–π ‚Äú–ø–æ–µ—Ö–∞–ª–∏‚Äù –∏ –ø–æ–ª—É—á–∞–π –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ! 

–í–ê–ñ–ù–û: –Ω–µ –∑–∞–±—É–¥—å –Ω–∞–∂–∏–º–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–æ—á—Ç–µ–Ω–∏—è, —á—Ç–æ–±—ã —Ç–µ–±–µ –≤—Å–µ –Ω—É–∂–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–∏—à–ª–∏.  """,reply_markup=cmd_start())
    # await message.bot.send_message()





@router.message(F.text == "‚òëÔ∏è–ü–æ–µ—Ö–∞–ª–∏")
async def get_work_forms( message: Message ):
    empty_message = await message.answer(
        "·Ö†",  # –Ω–µ–≤–∏–¥–∏–º—ã–π —Å–∏–º–≤–æ–ª
        reply_markup=ReplyKeyboardRemove()
    )
    await empty_message.delete()
    await message.answer("""–î–ª—è –Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Ñ–æ—Ä–º–∞—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ —Å –∫–æ–º–ø–∞–Ω–∏–µ–π
""", reply_markup=method_work())

# @router.message()
# async def work_form( message: Message ):
#     print(message.text.lower())

#
#
#
# @router.message(F.text.lower() == "")
# async def get_form_work( message: Message ):
#     if message.text == "":
#         text = ''
#     else:
#         text = ''
#
#
#     await message.answer(text,)


@router.callback_query((F.data == "employment contract") |( F.data == "agreement with an entrepreneur"))
async def get_work_forms(callback: CallbackQuery):
    if callback.data == "employment contract":
        await callback.message.answer(


            """–ó–∞–ø–æ–ª–Ω–∏ <a href="https://b24-aohl7e.bitrix24.site/crm_form_i0smq/">—Ñ–æ—Ä–º—É</a> –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ 
            
–ú–æ–∂–µ—à—å –Ω–µ —Ç–æ—Ä–æ–ø–∏—Ç—å—Å—è, –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≤ –ª—é–±–æ–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ –∑–∞–≤—Ç—Ä–∞. –ï—Å–ª–∏ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ—è–≤—è—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã ‚Äì –Ω–∞–ø–∏—à–∏ –õ–µ—Ä–µ @to_see_sea

–ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–æ—á—Ç—É –ø—Ä–∏–¥—ë—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –º–æ–∂–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å NDA. –ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è  NDA –¥–æ–≥–æ–≤–æ—Ä –≥–æ—Ç–æ–≤–∏—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 2-3 –¥–Ω–µ–π, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–∞–∫–∂–µ –ø—Ä–∏–¥—ë—Ç –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–æ—á—Ç—É.""",

            reply_markup=work_form(), parse_mode="HTML"
        )
    else:
        await callback.message.answer(

            """–ó–∞–ø–æ–ª–Ω–∏ <a href="https://b24-aohl7e.bitrix24.site/crm_form_ubin0/">—Ñ–æ—Ä–º—É</a> –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ 
            
–ú–æ–∂–µ—à—å –Ω–µ —Ç–æ—Ä–æ–ø–∏—Ç—å—Å—è, –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≤ –ª—é–±–æ–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ –∑–∞–≤—Ç—Ä–∞. –ï—Å–ª–∏ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ—è–≤—è—Ç—Å—è –≤–æ–ø—Ä–æ—Å—ã ‚Äì –Ω–∞–ø–∏—à–∏ –õ–µ—Ä–µ @to_see_sea

–ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–æ—á—Ç—É –ø—Ä–∏–¥—ë—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –º–æ–∂–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å NDA. –ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è  NDA –¥–æ–≥–æ–≤–æ—Ä –≥–æ—Ç–æ–≤–∏—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 2-3 –¥–Ω–µ–π, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–∞–∫–∂–µ –ø—Ä–∏–¥—ë—Ç –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–æ—á—Ç—É.""",
            reply_markup=work_form(), parse_mode="HTML"
        )


@router.callback_query(F.data == "form complete")
async def form_complete(callback: CallbackQuery):
    await callback.message.answer("""<b>–ü–æ–∑–¥—Ä–∞–≤–ª—è—é, —Ç—ã –ø–æ—á—Ç–∏ —É —Ü–µ–ª–∏!</b>

–í –Ω–∞—á–∞–ª–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞ –º—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–º —Ç–µ–±—è BANANAS  TEAM, –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–¥–≥–æ—Ç–æ–≤—å –ø–∞—Ä—É —Å–ª–æ–≤ –æ —Å–µ–±–µ –∏ –≤—ã–±–µ—Ä–∏ —Å–≤–æ—ë —Å–∞–º–æ–µ —Å–Ω–æ–≥—à–∏–±–∞—Ç–µ–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ. –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–±–∞–≤—å –≤ —Ñ–æ—Ä–º—É –ø–æ <a href="https://forms.gle/ePpmzzY59jgfQQzX7">—Å—Å—ã–ª–∫–µ</a>

<b>–ü–æ–¥—Å–∫–∞–∑–∫–∞.</b> –ß—Ç–æ–±—ã –±—ã–ª–æ –ª–µ–≥—á–µ –Ω–∞–ø–∏—Å–∞—Ç—å –æ —Å–µ–±–µ –≤–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ–º, –æ –∫–æ—Ç–æ—Ä—ã—Ö —Ç—ã –º–æ–∂–µ—à—å —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å: 
–í –∫–∞–∫–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –∏ –∫–æ–º–ø–∞–Ω–∏—è—Ö —Ç—ã —Ä–∞–±–æ—Ç–∞–ª? 
–ö–∞–∫–∞—è —Ç–≤–æ—è —Å—É–ø–µ—Ä—Å–∏–ª–∞ —Å–¥–µ–ª–∞–µ—Ç –∫–æ–º–ø–∞–Ω–∏—é –ª—É—á—à–µ? 
–ü–æ–¥–µ–ª–∏—Å—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –Ω–∞–≤—ã–∫–∞–º–∏.
–ö–∞–∫–∏–µ —É —Ç–µ–±—è —Ö–æ–±–±–∏ –∏ —É–≤–ª–µ—á–µ–Ω–∏—è?
–í—Å–ø–æ–º–Ω–∏ –∫–∞–∫–æ–π-—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç –æ —Å–µ–±–µ.

<b>–í–∞–∂–Ω–æ:</b> –ø–æ—Å—Ç–∞—Ä–∞–π—Å—è —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Å–∞–º–æ–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–º –∫—Ä–∞—Ç–∫–æ, —Ç–∞–∫ –∫–∞–∫ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –µ—Å—Ç—å –ª–∏–º–∏—Ç –∏ –º—ã –Ω–µ —Å–º–æ–∂–µ–º –Ω–∞–ø–∏—Å–∞—Ç—å –º–Ω–æ–≥–æ (–¥–æ 1500 —Å–∏–º–≤–æ–ª–æ–≤). –í –±—É–¥—É—â–µ–º —É —Ç–µ–±—è –±—É–¥–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Å–µ–±–µ –µ—â—ë –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –ø–æ—ç—Ç–æ–º—É –≤—Å—ë, —á—Ç–æ –Ω–µ –≤–ª–µ–∑–µ—Ç ‚Äì —Å–æ—Ö—Ä–∞–Ω—è–π!
""",
                         reply_markup=story_complete_key(), parse_mode="HTML"
                         )

@router.callback_query(F.data == "story complete")
async def story_complete(callback: CallbackQuery):
    await callback.message.answer("""–ú–æ–ª–æ–¥–µ—Ü! –ú—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é —Ç—ã –Ω–∞–º –ø–µ—Ä–µ–¥–∞–ª –∏ —Å –Ω–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ–º, –∫–æ–≥–¥–∞ —Ç—ã –ø—Ä–∏—Å—Ç—É–ø–∏—à—å –∫ –∑–∞–¥–∞—á–∞–º!

–ü–æ–∫–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –æ –Ω–∞—à–∏—Ö —Ü–µ–Ω–Ω–æ—Å—Ç—è—Ö –ø–æ <a href="https://drive.google.com/file/d/1Qojv_nSK1SV8-WyhuXROXKQMnW6H1LrE/view?usp=sharing">—Å—Å—ã–ª–∫–µ</a>

–ò –æ—Å—Ç–∞—ë–º—Å—è –Ω–∞ —Å–≤—è–∑–∏ ‚Äì –∑–∞ –¥–µ–Ω—å –¥–æ –¥–Ω—è –• —è –ø—Ä–∏—à–ª—é –≤—Å—é –≤–≤–æ–¥–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã ‚Äì –ø–∏—à–∏ –õ–µ—Ä–µ @to_see_sea""", parse_mode="HTML")



@router.callback_query(F.data == "send check list")
async def check_list(callback: CallbackQuery):
    await callback.message.answer("""–í–∞–∂–Ω–æ, —á—Ç–æ–±—ã —ç—Ç–∏ –ø—É–Ω–∫—Ç—ã –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –ï—Å–ª–∏ —Å –∫–∞–∫–∏–º-—Ç–æ –∏–∑ –Ω–∏—Ö –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã ‚Äì¬†–æ–±—Ä–∞—Ç–∏—Å—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫ –õ–µ—Ä–µ @to_see_sea

‚úî –ó–∞–ø–æ–ª–Ω–µ–Ω–∞ –∞–Ω–∫–µ—Ç–∞ –ø–æ —Å—Å—ã–ª–∫–µ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚úî –ü–æ–¥–ø–∏—Å–∞–Ω NDA
‚úî –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω —Ä–∞—Å—Å–∫–∞–∑ –æ —Å–µ–±–µ –∏ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —Ñ–æ—Ä–º—É

–ï—Å–ª–∏ –≤—Å—ë —Å–¥–µ–ª–∞–ª, —Ç–æ –¥–∞–ª—å—à–µ –ø—Ä–µ–¥–ª–∞–≥–∞—é –æ—Ç–¥—ã—Ö–∞—Ç—å. –ú—ã –æ—á–µ–Ω—å –∂–¥—ë–º —Ç–≤–æ–µ–≥–æ –≤—ã—Ö–æ–¥–∞, –¥–æ –∑–∞–≤—Ç—Ä–∞!""")


@router.callback_query(F.data == "what next")
async def access_complete(callback: CallbackQuery):
    # await callback.bot.send_message(1864950681, '–ú–æ–∂–Ω–æ –≤—ã–∫–ª—é—á–∞—Ç—å')
    ceo = get_ceo_by_username_in_bitrix(callback.from_user.username)
    await callback.message.answer(f"""–°–µ–≥–æ–¥–Ω—è –ø—Ä–æ–π–¥—ë—Ç —Ç–≤–æ—è –≤—Å—Ç—Ä–µ—á–∞ —Å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º, –≥–¥–µ –≤—ã –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–±—Å—É–¥–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏ –∑–∞–¥–∞—á–∏. 

–ù–∞–ø–æ–º–∏–Ω–∞—é, —á—Ç–æ —Ç–≤–æ–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å {ceo}. –¢—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—à—å –Ω–∞–ø–∏—Å–∞—Ç—å –µ–º—É –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ë–∏—Ç—Ä–∏–∫—Å. –¢–∞–∫–∂–µ —Ç–≤–æ–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –≥–æ—Ç–æ–≤–∏—Ç –ø–ª–∞–Ω –ø–æ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏, —á—Ç–æ–±—ã –ø—Ä–æ—â–µ –±—ã–ª–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –∑–∞–¥–∞—á–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–π —Å–∫–∏–Ω–µ—Ç —Ç–µ–±–µ –ø–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏. """,
                                  reply_markup=get_meet())


@router.callback_query(F.data == "send access complete")
async def send_info_about_services(callback: CallbackQuery):
    await callback.message.answer(
        """
    –í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ —Ä–∞–±–æ—Ç–µ —Å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç —Ç–µ–±–µ –≤ —Ä–∞–±–æ—Ç–µ:
    
    üìÑLastpass
    https://rbbase.ru/marketplace/app/32/?page=359873
    
    üìÑ –£—Å—Ç–∞–Ω–æ–≤–∫–µ –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –ë–∏—Ç—Ä–∏–∫—Å–∞
    https://rbbase.ru/marketplace/app/32/?page=359878–≠
    
    üìÑ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–±—â–∏–º –¥–∏—Å–∫–∞–º
    https://rbbase.ru/marketplace/app/32/?page=359877
    
    üôè–°–æ–æ–±—â–µ–Ω–∏—è –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ —ç—Ç–æ–º —á–∞—Ç–µ, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–µ—à—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.  
    """, reply_markup=send_reglaments_about_services())

@router.callback_query(F.data == "go meet")
async def access_cancel(callback: CallbackQuery):
    await callback.message.answer("""
–û—Ç–ª–∏—á–Ω–æ! –ï—Å–ª–∏ –±—É–¥—É—Ç –≤–æ–ø—Ä–æ—Å—ã ‚Äì –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Å—è –∏ –ø–∏—à–∏ –õ–µ—Ä–µ –∏–ª–∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é ‚Äì –æ–Ω–∏ —Å —Ä–∞–¥–æ—Å—Ç—å—é —Ç–µ–±–µ –ø–æ–º–æ–≥—É—Ç!

–ê —è –ø–æ–∫–∞ –ø—Ä–æ—â–∞—é—Å—å —Å —Ç–æ–±–æ–π, –¥–æ –Ω–æ–≤—ã—Ö –≤—Å—Ç—Ä–µ—áüôÉ""")